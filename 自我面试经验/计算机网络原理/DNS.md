### DNS

DNS占用**53**号端口，同时使用TCP和UDP协议。那么DNS在什么情况下使用这两种协议？

DNS在**区域传输的时候**使用TCP协议，其他时候使用UDP协议。

DNS区域传输的时候使用TCP协议：

1. **辅域名服务器**会定时（一般3小时）向**主域名服务器**进行查询以便了解数据是否有变动。如有变动，会执行一次区域传送，进行数据同步。区域传送使用TCP而不是UDP，因为**数据同步传送的数据量**比一个请求应答的数据量要多得多。

2. TCP是一种可靠连接，保证了数据的准确性。

**域名解析时**使用UDP协议：

**客户端向DNS服务器查询域名，一般返回的内容都不超过512字节，用UDP传输即可**。不用经过三次握手，这样DNS服务器负载更低，响应更快。理论上说，客户端也可以指定向DNS服务器查询时用TCP，但事实上，很多DNS服务器进行配置的时候，仅支持UDP查询包。

### DNS解析过程

DNS（Domain Name System）解析是将人类可读的域名（如www.example.com）转换为计算机可理解的 IP 地址的过程。当你在浏览器中输入一个网址时，**浏览器需要将域名解析为对应的 IP 地址**，以便连接到正确的服务器。DNS 解析过程涉及多个步骤，通常包括以下几个阶段：

1. **本地解析：**
   当你在浏览器中输入一个域名，首先会检查**操作系统的本地 DNS 缓存**，看是否已经解析过该域名。如果有缓存，则可以直接获取解析结果，节省时间。

2. **递归查询：**
   如果本地缓存中没有相应的记录，浏览器会**将请求发送给本地计算机的 DNS 解析器**（通常由你的 ISP 提供）。这个解析器可能已经缓存了一部分常见域名的记录，如果有，会返回解析结果。

3. **根域名服务器查询：**
   如果本地解析器没有相关的记录，它会向**根域名服务器**发出请求，询问**哪个顶级域名服务器**（比如.com、.org、.net等）负责该域名的解析。

4. **顶级域名服务器查询：**
   根域名服务器会返回顶级域名服务器的地址。本地解析器然后会**向顶级域名服务器发送请求**，询问负责该域名的**权威域名服务器**（Authoritative Name Server）的地址。

5. **权威域名服务器查询：**
   一旦知道了权威域名服务器的地址，本地解析器会**向权威域名服务器**发送请求，请求域名的 IP 地址。

6. **解析结果返回：**
   权威域名服务器会将域名对应的 IP 地址返回给本地解析器，然后本地解析器**将结果存储在缓存中**，并将结果返回给你的计算机。同时，该结果**也会在本地计算机的 DNS 缓存中存储一段时间**，以便下次访问时能够快速获取。

这个过程是一个递归查询的过程，因为本地解析器可能会**逐级查询多个 DNS 服务器**，最终获取到域名的 IP 地址。整个过程可能涉及多个层级的域名服务器，但由于缓存的存在，通常情况下解析速度会比较快。